# Environment Variables Reference

This file documents all environment variables used by Sanctum. Copy this file to `.env.local` and fill in the values.

---

## Required Variables (Production)

### Daily.co Integration
```bash
# Daily.co API key for creating rooms and managing video sessions
# Get from: https://dashboard.daily.co/developers
DAILY_API_KEY=your_daily_api_key_here
```

### Watermark Security
```bash
# HMAC secret for watermark generation (session tracking)
# Generate with: openssl rand -hex 32
# ‚ö†Ô∏è CRITICAL: Do NOT use DAILY_API_KEY as fallback
WATERMARK_HASH_SECRET=your_random_secret_here
```

### Payment Webhooks
```bash
# Webhook signature secret for payment provider (e.g., Stripe)
# Get from your payment provider's webhook settings
# ‚ö†Ô∏è CRITICAL: Must not be empty string
PAYMENT_WEBHOOK_SECRET=your_payment_webhook_secret_here

# Alternative payment webhook secret (if using multiple endpoints)
PAYMENTS_WEBHOOK_SECRET=your_payments_webhook_secret_here
```

### Identity Verification
```bash
# Veriff webhook signature secret
# Get from: https://station.veriff.com/
VERIFF_WEBHOOK_SECRET=your_veriff_webhook_secret_here
```

---

## Optional Variables (Development)

### Next.js Configuration
```bash
# Base path for Next.js routing (e.g., /sanctum)
# Leave empty for root deployment
NEXT_PUBLIC_BASE_PATH=

# Asset prefix for CDN (e.g., https://cdn.example.com)
NEXT_PUBLIC_ASSET_PREFIX=

# Enable trailing slashes on URLs (true/false)
NEXT_PUBLIC_TRAILING_SLASH=false

# Daily.co domain for video calls
NEXT_PUBLIC_DAILY_DOMAIN=sanctum.daily.co
```

### Feature Flags
```bash
# Override creator onboarding status for testing
# Example values: account_created, payment_pending, verified, active
NEXT_PUBLIC_CREATOR_ONBOARDING_STATUS=
```

---

## Development/Testing Only

### Mock States (‚ö†Ô∏è Never use in production)
```bash
# Mock verification state to bypass Veriff checks
# Values: verified, unverified, pending
# ‚ö†Ô∏è Security risk if set in production
VERIFICATION_MOCK_STATE=

# Mock payment state to bypass payment checks
# Values: settled, unsettled
# ‚ö†Ô∏è Security risk if set in production
PAYMENT_MOCK_STATE=
```

---

## Environment Variable Security Guidelines

### Public vs Private Variables

**Public Variables** (prefixed with `NEXT_PUBLIC_`):
- ‚úÖ Safe to expose to browser
- Examples: Base path, asset prefix, Daily domain
- Used in client-side code

**Private Variables** (no prefix):
- üîí Server-side only, never exposed to browser
- Examples: API keys, webhook secrets
- Never use in client components

### Secret Generation

Generate strong secrets using:
```bash
# Generate 32-byte hex string
openssl rand -hex 32

# Generate 64-byte base64 string
openssl rand -base64 64

# Generate UUID
uuidgen
```

### Security Best Practices

1. **Never commit `.env.local`** - Add to `.gitignore`
2. **Use different secrets per environment** (dev, staging, prod)
3. **Rotate secrets regularly** (every 90 days minimum)
4. **Use a secret manager** for production (e.g., Vercel Secrets, AWS Secrets Manager)
5. **Validate required secrets at startup** - App should fail fast if missing
6. **Never use default/fallback secrets** in production
7. **Log access to secrets** for audit trails

---

## Vercel Deployment

When deploying to Vercel:

1. Add all required variables in Vercel dashboard:
   - Project Settings ‚Üí Environment Variables

2. Set appropriate scopes:
   - **Production**: Production-only secrets
   - **Preview**: Testing/staging secrets
   - **Development**: Local development secrets

3. Use Vercel CLI to sync:
```bash
vercel env pull .env.local
```

---

## Variable Validation Checklist

Before deploying to production, verify:

- [ ] `DAILY_API_KEY` is set and valid
- [ ] `WATERMARK_HASH_SECRET` is set (not using fallback)
- [ ] `PAYMENT_WEBHOOK_SECRET` is set (not empty string)
- [ ] `PAYMENTS_WEBHOOK_SECRET` is set (not empty string)
- [ ] `VERIFF_WEBHOOK_SECRET` is set and valid
- [ ] All secrets are unique and properly generated
- [ ] Mock state variables are NOT set
- [ ] Secrets are different from development environment
- [ ] Secrets are stored in secure secret manager
- [ ] No secrets are committed to version control

---

## Common Issues

### Issue: "DAILY_API_KEY is not defined"
**Solution**: Ensure `DAILY_API_KEY` is set in `.env.local` and restart dev server

### Issue: "Webhook verification failed"
**Solution**: Verify webhook secrets match those configured in provider dashboard

### Issue: Watermark uses DAILY_API_KEY fallback
**Solution**: Set explicit `WATERMARK_HASH_SECRET` to avoid using API key as secret

### Issue: Build fails due to missing variables
**Solution**: Required variables should fail at runtime, not build time. Check API routes.

---

## Migration Guide

### From v0.1.0 (Current)

If migrating from current version:

1. Add new `WATERMARK_HASH_SECRET` variable:
   ```bash
   WATERMARK_HASH_SECRET=$(openssl rand -hex 32)
   ```

2. Ensure `PAYMENTS_WEBHOOK_SECRET` is not empty:
   ```bash
   # Current code allows empty string - SECURITY ISSUE
   # Fix by setting explicit value
   PAYMENTS_WEBHOOK_SECRET=your_secret_here
   ```

3. Remove any mock state variables from production:
   ```bash
   # Remove these from production .env:
   unset VERIFICATION_MOCK_STATE
   unset PAYMENT_MOCK_STATE
   ```

---

## Testing Environment Variables

For local testing:

```bash
# .env.test (for automated tests)
NODE_ENV=test
DAILY_API_KEY=test_daily_key
WATERMARK_HASH_SECRET=test_watermark_secret
PAYMENT_WEBHOOK_SECRET=test_payment_secret
PAYMENTS_WEBHOOK_SECRET=test_payments_secret
VERIFF_WEBHOOK_SECRET=test_veriff_secret
```

---

## References

- [Next.js Environment Variables](https://nextjs.org/docs/basic-features/environment-variables)
- [Vercel Environment Variables](https://vercel.com/docs/concepts/projects/environment-variables)
- [Daily.co API Documentation](https://docs.daily.co/reference/rest-api)
- [Veriff Integration Guide](https://developers.veriff.com/)

---

**Last Updated**: 2026-02-13  
**Audit Report**: See `docs/SECURITY_AUDIT_REPORT.md` for security findings
